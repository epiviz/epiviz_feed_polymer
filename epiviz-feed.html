<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import"
      href="bower_components/promise-polyfill/promise-polyfill-lite.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="bower_components/paper-search/paper-search-panel.html">
<link rel="import" href="bower_components/iron-collapse/iron-collapse.html">
<link rel="import"
      href="bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">

<link rel="import" href="bower_components/paper-spinner/paper-spinner.html">
<link rel="import"
      href="bower_components/paper-spinner/paper-spinner-lite.html">

<link rel="import" href="bower_components/paper-card/paper-card.html">

<link rel="import" href="bower_components/paper-card/paper-card.html">
<link rel="import" href="bower_components/web-socket/web-socket.html">

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>

<dom-module id="epiviz-feed">
    <template>
        <style>
            :host {
                display: inline-block;
            }

            .show-hide-button {
                padding: 10px;
                background-color: #f3f3f3;
                border: 1px solid #dedede;
                border-radius: 5px;
                font-size: 16px;
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
                text-align: center;
                display: block;
            }

            :host([opened]) #trigger {
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
            }

            paper-card {
                margin: 3px;
                padding: 5px;
                border-radius: 5px;
                cursor: pointer;
            }

            .feed-pane-container {
                /*float: right;*/
                position: fixed;
                z-index: 100;
                right: 0;
                background: #e6ecf0;
                height: 100%;
            }

            .pane.feed-pane {
                width: 400px;
                padding: 5px;
                flex-shrink: 0;
                /*position: absolute;*/
                /*z-index: 10;*/
            }

            .pane.feed-pane:hover {
                height: 100%;
            }

            .pane.feed-pane h2 {
                color: #38425D;
                font-size: 16px;
                line-height: 20px;
                font-weight: 700;
                margin: 0 0 10px;
                display: block;
                /*-webkit-margin-before: 0.83em;*/
                /*-webkit-margin-after: 0.83em;*/
                -webkit-margin-start: 0;
                -webkit-margin-end: 0;
            }

            .pane.feed-pane h3 {
                font-size: 14px;
                display: block;
                -webkit-margin-before: 0em;
                -webkit-margin-after: 0em;
                -webkit-margin-start: 0px;
                -webkit-margin-end: 0px;
                font-weight: normal;
            }

            .open-sans-font {
                font-family: 'Open Sans', sans-serif;
            }

            .arial-sans-font {
                font-family: "Segoe UI", Arial, sans-serif;
            }

            .feed-header {

            }

            .feed-content {
                font-size: 12px;
                line-height: 18px;
                cursor: pointer;
            }

            .feed-element-container {
                background-color: #fff;
                /*border-style: groove;*/
                cursor: pointer;
                border-bottom: 2px solid #e6ecf0;
                padding: 3px;
            }

            .feed-element-container.selected {
                outline: 0;
                background-color: #ddd;
            }

            .feed-show-hide {
                position: fixed;
                right: 10px;
                top: 10px;
                z-index: 150;
            }

            .grouped-list {
                padding: 15px;
                border: 1px solid #dedede;
            }

            .group-dropdown-menu {
                max-width: 160px;
            }

            .overflow-y {
                overflow-y: scroll;
            }

            #feed-results {
                max-height: 500px;
            }

            paper-spinner-lite {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translateX(-50%) translateY(-50%);
                height: 75px;
                width: 75px;
            }

        </style>
        <!--<iron-ajax id="requestResults"-->
                   <!--params=''-->
                   <!--handle-as="json"-->
                   <!--on-response="handleResponse"-->
                   <!--debounce-duration="300">-->
        <!--</iron-ajax>-->
        <!--<web-socket id="requestResults"-->
            <!--url="ws://127.0.0.1:5001"-->
            <!--auto>-->
            <!--&lt;!&ndash;on-open="subscribeSocket"&ndash;&gt;-->
            <!--&lt;!&ndash;on-message="showMessage"&ndash;&gt;-->
            <!--&lt;!&ndash;on-error="showError"&ndash;&gt;-->
            <!--&lt;!&ndash;on-close="endSocket"&ndash;&gt;-->
        <!--</web-socket>-->
        <!--<button icon= "editor" id='show-hide-toggle'-->
        <!--class="feed-show-hide show-hide-button"-->
        <!--on-click="showHideClick">Hide-->
        <!--</button>-->
        <paper-button raised id='show-hide-toggle'
                      class="feed-show-hide show-hide-button"
                      on-click="showHideClick">Hide
        </paper-button>
        <div id="feed-container" class="feed-pane-container">
            <div class="pane feed-pane">
                <div class="feed-header arial-sans-font">
                    <h2>
                        <iron-icon icon="icons:trending-up"></iron-icon>
                        Feed Results
                        <paper-dropdown-menu class="group-dropdown-menu"
                                             label="GroupBy">
                            <paper-listbox class="dropdown-content"
                                           selected="{{groupByMethod}}"
                                           attr-for-selected="label"
                                           on-selected-item-changed="groupByChanged">
                                <paper-item label="All Types">All
                                    Types
                                </paper-item>
                                <!--<paper-item label="Tissue Type">Tissue-->
                                    <!--Type-->
                                <!--</paper-item>-->
                                <paper-item
                                        label="Computation Type">Computation
                                    Type
                                </paper-item>
                                <paper-item label="Data Type">Data
                                    Type
                                </paper-item>
                            </paper-listbox>
                        </paper-dropdown-menu>
                    </h2>
                    <paper-search-panel
                            search="{{searchString}}"
                            count="5"
                            items="{{results}}"
                            hide-filter-button="True"
                            on-search="searchQuery"
                            no-results-text=""
                            on-search-changed="searchQuery">
                    </paper-search-panel>
                </div>
                <div id="feed-results" class="overflow-y">
                    <paper-spinner-lite active
                                        class="blue"
                                        hidden$="[[_hideSpinner]]">

                    </paper-spinner-lite>
                    <template is="dom-repeat"
                              items="{{filteredResultsByType}}">
                        <paper-button id="trigger trigger-[[item.type]]"
                                      class="show-hide-button"
                                      on-click="groupToggle"
                                      aria-expanded$="[[opened]]">
                            <iron-icon icon="icons:menu"></iron-icon>
                            [[item.type]]
                        </paper-button>
                        <iron-collapse id="collapse-[[item.type]]"
                                       opened="opened">
                            <div class="grouped-list">
                                <template is="dom-repeat"
                                          items="[[item.list]]">
                                    <paper-card on-tap="itemTapped">
                                        <h3>The [[item.computation-type]]
                                            between [[item.data-type-one]]
                                            <i>[[item.attribute-one]]</i>
                                            and
                                            [[item.data-type-two]]
                                            <i>[[item.attribute-two]]</i>
                                            is
                                            <b>[[item.value]]</b>. The
                                            p-value is
                                            <i>[[item.pvalue]]</i>.
                                        </h3>

                                    </paper-card>
                                </template>
                            </div>
                        </iron-collapse>
                    </template>
                </div>

                <!--<simple-iron-collapse class="pane feed-pane arial-sans-font"-->
                <!--filtered-results="{{filteredResults}}"-->
                <!--opened="[[opened]]"-->
                <!--search-string="[[searchString]]"></simple-iron-collapse>-->

            </div>
        </div>
        <epiviz-navigation id="epiviz_env"
                           chr="{{chr}}"
                           start="{{start}}"
                           end="{{end}}">
            <!--<epiviz-json-scatter-plot class="charts" id="WLs"-->
            <!--dim-s="[&quot;expression_lung___normal&quot;,&quot;methylation_thyroid&quot;]" data="[{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.031022222222222222},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0021166666666666656},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:0.0021166666666666656},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.022628571428571425},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.033350000000000005},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.027325000000000002},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.00726},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.02318},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.011949999999999997},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.011949999999999997},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.011949999999999997},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.02835909090909091},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.024399999999999998},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:-0.02125},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:-0.02125},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:-0.02125},{&quot;expression_lung___normal&quot;:0.3333333333,&quot;methylation_thyroid&quot;:-0.0724},{&quot;expression_lung___normal&quot;:0.6666666667,&quot;methylation_thyroid&quot;:-0.0992},{&quot;expression_lung___normal&quot;:0.6666666667,&quot;methylation_thyroid&quot;:-0.0992},{&quot;expression_lung___normal&quot;:0.6666666667,&quot;methylation_thyroid&quot;:-0.0992},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.027016666666666665},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.055850000000000004},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.07255},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0666},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0666},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0343},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.01235},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0652},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.02615},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0036000000000000003},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.01458},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0013000000000000002},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.04228333333333333},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.01774},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.01774},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.004960000000000001},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.004960000000000001},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:-0.0101},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0021666666666666666},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0029000000000000002},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.021239999999999995},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.017089999999999998},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:0.037375},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.030516666666666664},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.030516666666666664},{&quot;expression_lung___normal&quot;:0.3333333333,&quot;methylation_thyroid&quot;:0.01052},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0038},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0038},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.00518},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.00518},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.00518},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.00518},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:-0.010575},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0264},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0264},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.023725000000000003},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.024255555555555555},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.024255555555555555},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0021999999999999997},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.0021999999999999997},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:0.009224999999999999},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:0.0011250000000000001},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:0.0011250000000000001},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:-0.0064333333333333334},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0064333333333333334},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.02928666666666667},{&quot;expression_lung___normal&quot;:1,&quot;methylation_thyroid&quot;:0.02928666666666667},{&quot;expression_lung___normal&quot;:0.3333333333,&quot;methylation_thyroid&quot;:-0.005625},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0006999999999999992},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.025333333333333333},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.0065875000000000005},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.010366666666666668},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.010366666666666668},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:-0.02114285714285714},{&quot;expression_lung___normal&quot;:0,&quot;methylation_thyroid&quot;:0.004633333333333332}]">-->
            <!--</epiviz-json-scatter-plot>-->
        </epiviz-navigation>

    </template>
    <script>
        Polymer({
            is: 'epiviz-feed',
            properties: {
                results: {
                    type: Array
                },
                filteredResults: {
                    type: Object,
                    value: {},
                    notify: true
                },
                filteredResultsByType: {
                    type: Array,
                    notify: true
                },
                selectedItem: {
                    type: Object,
                    notify: true
                },
                selectItem: {
                    type: Object,
                    notify: true
                },
                groupByMethod: {
                    type: String,
                    value: "All Types",
                    notify: true
                },
                searchString: {
                    type: String
                },
                opened: {
                    type: Boolean,
                    reflectToAttribute: true
                },
                chr: {
                    type: String,
                    value: "chr11",
                    notify: true
                },
                start: {
                    type: Number,
                    value: 3947953,
                    notify: true
                },
                end: {
                    type: Number,
                    value: 7164991,
                    notify: true
                },
                _hideSpinner: {
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },

            observers: [
                '_rangeChanged(chr, start, end)'
            ],

            _rangeChanged: function (chr, start, end) {
//                this.filteredResultsByType = [];
//                this.set("_hideSpinner", false);
//                this.$.requestResults.url =
//                        "ws://127.0.0.1:5001";
//                this.$.requestResults.open();
//                var msgToSend = {
//                    start: this.start,
//                    end: this.end,
//                    chr: this.chr
//                };
////                + this.chr +
////                        "&start=" + this.start + "&end=" + this.end;
//
//                this.$.requestResults.send(msgToSend);
            },
            attached: function() {
                var self = this;
                this.socket =
                        io.connect("http://localhost:5000/test");

            // Event handler for new connections.
            // The callback function is invoked when a connection with the
            // server is established.
            this.socket.on('connect', function() {
                console.log('connection on!');
                self.socket.emit('my_event', {data: 'I\'m connected!'});
            });

            // Event handler for server sent data.
            // The callback function is invoked whenever the server emits data
            // to the client. The data is then displayed in the "Received"
            // section of the page.
            this.socket.on('my_response', function(msg) {
                console.log(msg);
                console.log('response received!');
            });

            },
            ready: function () {
//                this.$.requestResults.url =
//                        "http://localhost:5001/chr=" + this.chr +
//                        "&start=" + this.start + "&end=" + this.end;
//
//                this.$.requestResults.generateRequest();
                this.notMethy = true;
            },
            handleResponse: function (data) {
                this.results = data.detail.response;
                if (this.results != null) {
                    this.filteredResults = this._groupByResults(this.results,
                            this.groupByMethod);
                    this.filteredResultsByType =
                            this._toTypeArray(this.filteredResults);
                    getDescription(this.results);
                    this.set("_hideSpinner", true);
                }
            },

            itemTapped: function (e) {
                this.clicked(e.model.item);
            },

            clicked: function (result) {
                var test_measure = result['data-source'];

                // check whether there is chart already in the main visualization.
                if (result['plot-id'] != null &&
                        document.getElementById(result['plot-id']) != null) {
                    var elementToFocus =
                            document.getElementById(result['plot-id']);
                    elementToFocus.scrollIntoView();
                    $(elementToFocus).effect("highlight", {
                        color: '#e6ecf0b'
                    }, 2000);
                    return;
                }

                // methylation charts should be customized.
                if ((result['data-type-one'] == 'methylation' &&
                        result['data-type-two'] == 'expression' ) ||
                        (result['data-type-one'] == 'expression' &&
                        result['data-type-two'] == 'methylation')) {
                    var dims = [result['data-type-one'] + '_' +
                    result['attribute-one'],
                        result['data-type-two'] + '_'
                        + result['attribute-two']];
                    var data = result['data'];

                    var elementId = this._generateId();

                    var customScatterPlot =
                            "<epiviz-json-scatter-plot class='charts' id=" +
                            elementId +
                            " dim-s='" +
                            JSON.stringify(dims) +
                            "' data='" +
                            JSON.stringify(data) +
                            "'></epiviz-json-scatter-plot>";
                    // record the plot-id to scroll to the right position when
                    // click to add the chart, so do not create repeated charts
                    result['plot-id'] = elementId;

                    $("#navHeader").append(customScatterPlot);
//                    epivizScatterPlot = customScatterPlot
//                    customScatterPlot.chartSettings.title = result['title'];
                }
                // two block data, add a block overlapping track
                else if (result['data-type-one'] == 'block' &&
                        result['data-type-two'] == 'block') {
                    test_measure[0]['type'] = 'range';
                    test_measure[1]['type'] = 'range';
                    test_measure[0]['metadata'] = null;
                    test_measure[1]['metadata'] = null;
                    var block_element =
                            document.createElement('epiviz-blocks-track');
                    block_element.setAttribute('measurements',
                            JSON.stringify(test_measure));

                    block_element.className = 'charts';

                    // record the plot-id to scroll to the right position when
                    // click to add the chart, so do not create repeated charts
                    result['plot-id'] = block_element.getAttribute('plot-id');
                    Polymer.dom(document.getElementById("epiviz_env")).appendChild(block_element);

                    var settings =
                            JSON.parse(JSON.stringify(block_element.chartSettings));
                    settings.title = result['title'];
                    var domElem = Polymer.dom(document.getElementById("epiviz_env")).querySelector('[plot-id$="' +
                                    result['plot-id'] +
                                    '"]');

                    domElem.setAttribute("chart-settings",
                            JSON.stringify(settings));
                    domElem.scrollIntoView();
                    $(domElem).effect("highlight", {
                        color: '#e6ecf0b'
                    }, 2000);
                }
                else {
                    var element = document.createElement('epiviz-scatter-plot');
                    element.setAttribute('measurements',
                            JSON.stringify(test_measure));
                    element.chartSettings.title = result['title'];
                    element.className = 'charts';

                    // record the plot-id to scroll to the right position when
                    // click to add the chart, so do not create repeated charts
                    result['plot-id'] = element.getAttribute('plot-id');

                    Polymer.dom(document.getElementById("epiviz_env")).appendChild(element);
                    element.scrollIntoView();
                    $(element).effect("highlight", {
                        color: '#e6ecf0b'
                    }, 2000);
                }
            },
            showHideClick: function () {
                var element = document.getElementById('show-hide-toggle');
                var feed_element = document.getElementById('feed-container');
                if (element.textContent.trim() == "Hide") {
                    element.textContent = "Show";
                    feed_element.style.display = 'none';
                } else {
                    element.textContent = "Hide";
                    feed_element.style.display = 'block';
                }
            },
            searchQuery: function () {
                console.log("search executed!");
                if (this.searchString != undefined && this.searchString != null
                        && this.searchString != "") {
                    var query = this.searchString;
                    var filtered = this.results.filter(function (result) {
                        // Array.prototype.filter
                        if (result['attribute-one'].includes(query) ||
                                result['attribute-two'].includes(query) ||
                                result['computation-type'].includes(query) ||
                                result['data-type-one'].includes(query) ||
                                result['data-type-two'].includes(query) ||
                                result['value'].toString().includes(query)) {
                            return result;
                        }
                    });
//                    this.filteredResults = {};
//                    this.filteredResults["all"] = filtered;
                    this.filteredResults = this._groupByResults(filtered,
                            this.groupByMethod);
                    this.filteredResultsByType = this._toTypeArray(this.filteredResults);
                } else if (this.results != undefined) {
                    this.filteredResults = this._groupByResults(this.results,
                            this.groupByMethod);
                    this.filteredResultsByType =
                            this._toTypeArray(this.filteredResults);
                }
            },
            groupByChanged: function (e) {
                if (this.groupByMethod != undefined && this.results !=
                        undefined) {
                    var groupByType = this.groupByMethod;
//                this.groupByMethod = groupByType;
                    console.log(groupByType);
                    if (groupByType == "All") {
                        $("#trigger-All").style.visibility = 'hidden';
                    }
                    this.filteredResults = this._groupByResults(this.results,
                            groupByType);
                    this.filteredResultsByType =
                            this._toTypeArray(this.filteredResults);
                }
            },
            _groupByResults: function (resultsList, groupByType) {
                switch (groupByType) {
                    case "Computation Type":
                        var groupedResults =
                                resultsList.reduce(function (r, a) {
                                    r[a["computation-type"]] =
                                            r[a["computation-type"]] || [];
                                    r[a["computation-type"]].push(a);
                                    return r;
                                }, Object.create(null));
                        return groupedResults;
                        break;
//                    case "Tissue Type":
//                        var groupedResults =
//                                resultsList.reduce(function (r, a) {
//                                    r[a["computation-type"]] =
//                                            r[a["computation-type"]] || [];
//                                    r[a["computation-type"]].push(a);
//                                    return r;
//                                }, Object.create(null));
//                        this.filteredResults = groupedResults;
//                        this.filteredResultsByType =
//                                this._toTypeArray(this.filteredResults);
//                        break;
                    case "Data Type":
                        var groupedResults =
                                resultsList.reduce(function (r, a) {
                                    var key_one = a["data-type-one"];
                                    var key_two = a["data-type-two"];
                                    r[key_one] =
                                            r[key_one] || [];
                                    r[key_one].push(a);
                                    if (key_one != key_two) {
                                        r[key_two] = r[key_two] || [];
                                        r[key_two].push(a);
                                    }
                                    return r;
                                }, Object.create(null));
                        return groupedResults;
                        break;
                    case "All Types":
                        if (resultsList.length == 0) {
                            return [];
                        }
                        var groupedResults = {"all": resultsList};
                        return groupedResults;
                    default:
                        // do nothing for now
                }
            },
            groupToggle: function (e) {
                $("#collapse-" + e.model.item.type).toggle();
            },
            _toTypeArray: function (resultsByType) {
                if (resultsByType
                        != undefined && Object.keys(resultsByType).length >
                        0) {
                    return Object.keys(resultsByType).map(function (key) {
                        if (resultsByType[key] == undefined
                                || resultsByType[key].length == 0) {
                            return;
                        }
                        return {
                            type: key,
                            list: resultsByType[key]
                        };
                    });
                } else {
                    return [];
                }
            },
            _generateId: function () {
                var text = "";
                var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

                for (var i = 0; i < 3; i++)
                    text += possible.charAt(Math.floor(Math.random() * possible.length));

                return text;
            },
            _getIndexClass: function (result, isSelected) {
                var classes = 'feed-element-container';
                var test_measure = result['data-source'];

                // check whether there is chart already in the main visualization.
                if ((result['plot-id'] != null &&
                        document.getElementById(result['plot-id']) != null)
                        || isSelected) {
                    classes += ' selected';
                }
                return classes;
            }
        });

        function getDescription(results) {
            results.forEach(function (result) {
                // get description
                result['description'] = result['computation-type'] +
                        ' between ' + result['data-type-one'] + ' ' +
                        result['attribute-one'] + ' and ' +
                        result['data-type-two'] + ' ' +
                        result['attribute-two'] + ' is ' +
                        result['value'].toFixed(2) + '.';
                // get title
                result['title'] = result['computation-type'] + ' = ' +
                        result['value'].toFixed(2) + ', p-value is ' +
                        result['pvalue'].toFixed(2);
//                result['title'] = result['computation-type'] +
//                        ' between ' + result['data-type-one'] + ' ' +
//                        result['attribute-one'] + ' and ' +
//                        result['data-type-two'] + ' ' +
//                        result['attribute-two'];
            });
        }

    </script>
</dom-module>